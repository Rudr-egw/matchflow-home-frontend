<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MatchFlow â€” Request</title>
  <style>
    :root{
      --bg:#070A0F;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(0,0,0,.22);
      --line: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --accent: #6ea8ff;
      --accent2:#7cf7c6;
      --warn: #ffcc66;
      --shadow: 0 28px 90px rgba(0,0,0,.55);
      --r: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 50% 18%, rgba(110,168,255,.20), transparent 60%),
        radial-gradient(900px 600px at 18% 92%, rgba(124,247,198,.14), transparent 58%),
        radial-gradient(900px 600px at 84% 92%, rgba(255,255,255,.07), transparent 62%),
        var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      overflow:hidden;
    }

    .top{
      height:64px;
      padding:0 18px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      position:sticky; top:0;
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0}
    .logo{
      width:34px;height:34px;border-radius:14px;
      background: linear-gradient(135deg, rgba(110,168,255,.95), rgba(124,247,198,.85));
      box-shadow: 0 18px 45px rgba(110,168,255,.18);
      flex:0 0 auto;
    }
    .brandTxt{min-width:0}
    .brandTxt b{display:block; font-size:14px; letter-spacing:.2px}
    .brandTxt span{
      display:block; font-size:12px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 52ch;
    }
    .nav{display:flex; align-items:center; gap:10px;}
    .link{
      color: rgba(255,255,255,.82);
      text-decoration:none;
      font-size:13px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      transition: transform .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .link:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}

    .layout{
      height: calc(100% - 64px);
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:14px;
      padding:14px;
    }
    @media (max-width: 980px){
      body{overflow:auto}
      .layout{grid-template-columns:1fr; height:auto; padding-bottom:24px;}
    }

    .panel{
      border-radius: var(--r);
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    /* Left */
    .left{padding:16px}
    .left h3{margin:0 0 10px; font-size:13px; letter-spacing:.2px}
    .how{
      display:grid;
      gap:10px;
    }
    .item{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      border-radius:18px;
      padding:12px 12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .tick{
      width:18px;height:18px;border-radius:7px;
      background: rgba(124,247,198,.14);
      border:1px solid rgba(124,247,198,.32);
      display:flex; align-items:center; justify-content:center;
      flex:0 0 auto;
      margin-top:1px;
      font-weight:900;
      color: rgba(124,247,198,.95);
      font-size:12px;
    }
    .item b{display:block; font-size:13px; margin-bottom:2px}
    .item span{display:block; font-size:12px; color:var(--muted); line-height:1.35}

    .tip{
      margin-top:12px;
      padding:12px 12px;
      border-radius:18px;
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.84);
      font-size:12px;
      line-height:1.45;
    }

    /* Right chat */
    .right{
      display:flex;
      flex-direction:column;
      min-height: 560px;
      height:100%;
    }

    .chatTop{
      padding:14px 14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: rgba(0,0,0,.14);
    }
    .stepWrap b{display:block; font-size:13px}
    .stepWrap span{display:block; font-size:12px; color:var(--muted); margin-top:2px}
    .progWrap{display:flex; align-items:center; gap:10px}
    .bar{
      width:190px; height:10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(110,168,255,.95), rgba(124,247,198,.80));
      border-radius:999px;
      transition: width .65s ease;
    }
    .pct{font-size:12px; color: rgba(255,255,255,.80); white-space:nowrap}

    .chat{
      flex:1;
      padding:16px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
      scroll-behavior:smooth;
      background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 25%);
    }
    .row{display:flex; gap:10px; align-items:flex-end; animation: pop .22s ease both;}
    @keyframes pop{from{transform:translateY(6px); opacity:0}to{transform:translateY(0); opacity:1}}
    .row.user{justify-content:flex-end}
    .avatar{
      width:30px;height:30px;border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      font-weight:900; font-size:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.78);
      flex:0 0 auto;
    }
    .avatar.bot{
      border-color: rgba(110,168,255,.22);
      background: rgba(110,168,255,.12);
      color: rgba(110,168,255,.95);
    }
    .bubble{
      max-width: 78%;
      padding:12px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      line-height:1.35;
      font-size:13px;
      white-space:pre-wrap;
    }
    .row.user .bubble{
      background: rgba(110,168,255,.16);
      border-color: rgba(110,168,255,.25);
    }

    .typing{display:inline-flex; gap:6px; align-items:center;}
    .typing i{
      width:7px;height:7px;border-radius:50%;
      background: rgba(255,255,255,.62);
      display:inline-block;
      animation: bounce 1s infinite ease-in-out;
    }
    .typing i:nth-child(2){animation-delay:.12s}
    .typing i:nth-child(3){animation-delay:.24s}
    @keyframes bounce{0%,100%{transform:translateY(0); opacity:.55}50%{transform:translateY(-4px); opacity:1}}

    .card{
      width:100%;
      max-width:78%;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      padding:14px;
    }
    .card h4{margin:0 0 6px; font-size:14px}
    .card p{margin:0 0 12px; font-size:12px; color:var(--muted); line-height:1.45}

    .btnRow{display:flex; gap:10px; flex-wrap:wrap;}
    .btn{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      padding:11px 14px;
      border-radius:16px;
      font-weight:900;
      font-size:13px;
      transition: transform .12s ease, background .12s ease;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:9px;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.09)}
    .btn.primary{
      border:none;
      color:#071018;
      background: linear-gradient(135deg, rgba(110,168,255,.95), rgba(124,247,198,.80));
    }
    .btn.warn{
      border-color: rgba(255,204,102,.30);
      background: rgba(255,204,102,.12);
    }
    .btn[disabled]{opacity:.55; cursor:not-allowed; transform:none}

    .checkboxRow{
      display:flex; gap:10px; align-items:center;
      margin-top:8px;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
    }

    /* Form */
    form{width:100%}
    label{display:block; font-size:12px; color:rgba(255,255,255,.86); margin:10px 0 6px}
    input, textarea, select{
      width:100%;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      padding:10px 10px;
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    textarea{min-height:110px; resize:vertical}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}

    .sendStatus{
      display:none;
      align-items:center;
      gap:10px;
      margin-top:10px;
      font-size:12px;
      color: rgba(255,255,255,.74);
    }
    .spin{
      width:16px;height:16px;border-radius:50%;
      border:2px solid rgba(255,255,255,.18);
      border-top-color: rgba(124,247,198,.85);
      animation: spin .85s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <header class="top">
    <div class="brand">
      <div class="logo"></div>
      <div class="brandTxt">
        <b>MatchFlow</b>
        <span>Upload photos â†’ submit request â†’ we reach out for quote ranges</span>
      </div>
    </div>
    <nav class="nav">
      <a class="link" href="index.html">Home</a>
      <a class="link" href="about.html">About</a>
    </nav>
  </header>

  <div class="layout">
    <aside class="panel left">
      <h3>What happens next</h3>
      <div class="how">
        <div class="item">
          <div class="tick">âœ“</div>
          <div><b>Upload photos</b><span>Optional, but helps providers estimate more accurately.</span></div>
        </div>
        <div class="item">
          <div class="tick">âœ“</div>
          <div><b>Submit your request</b><span>We collect the key details and start outreach.</span></div>
        </div>
        <div class="item">
          <div class="tick">âœ“</div>
          <div><b>Quote-based pricing</b><span>Final price comes from provider quotes. We aim near your goal.</span></div>
        </div>
      </div>

      <div class="tip">
        <b>Tip:</b> When Dropbox asks for a name, use the same name youâ€™ll enter on the form.
        That helps us match photos to your request quickly.
      </div>
    </aside>

    <section class="panel right">
      <div class="chatTop">
        <div class="stepWrap">
          <b id="stepTitle">Step 1 of 2 â€” Photos</b>
          <span id="stepSub">Takes about 30â€“60 seconds.</span>
        </div>
        <div class="progWrap">
          <div class="bar"><div class="fill" id="fill"></div></div>
          <div class="pct" id="pct">0%</div>
        </div>
      </div>

      <div class="chat" id="chat"></div>
    </section>
  </div>

  <script>
    const DROPBOX_LINK = "https://www.dropbox.com/request/x3H95v2Lx3fOEIEGFdQk";
    const FORMSPREE_ACTION = "https://formspree.io/f/mbdogolb";

    const chat = document.getElementById("chat");
    const stepTitle = document.getElementById("stepTitle");
    const stepSub = document.getElementById("stepSub");
    const fill = document.getElementById("fill");
    const pct = document.getElementById("pct");

    function scrollDown(){ chat.scrollTop = chat.scrollHeight; }
    function setProgress(p){
      const c = Math.max(0, Math.min(100, p));
      fill.style.width = c + "%";
      pct.textContent = c + "%";
    }

    function addMsg(text, who="bot", html=false){
      const row = document.createElement("div");
      row.className = "row " + (who === "user" ? "user" : "bot");

      const avatar = document.createElement("div");
      avatar.className = "avatar " + (who === "bot" ? "bot" : "");
      avatar.textContent = who === "bot" ? "MF" : "YOU";

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      if (html) bubble.innerHTML = text;
      else bubble.textContent = text;

      if (who === "user") { row.appendChild(bubble); row.appendChild(avatar); }
      else { row.appendChild(avatar); row.appendChild(bubble); }

      chat.appendChild(row);
      scrollDown();
      return bubble;
    }

    function addTyping(){
      const row = document.createElement("div");
      row.className = "row bot";
      const avatar = document.createElement("div");
      avatar.className = "avatar bot";
      avatar.textContent = "MF";
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = `<span class="typing"><i></i><i></i><i></i></span>`;
      row.appendChild(avatar);
      row.appendChild(bubble);
      chat.appendChild(row);
      scrollDown();
      return row;
    }
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));
    async function botSay(t){
      const k = addTyping();
      await sleep(650);
      k.remove();
      addMsg(t, "bot");
    }

    // Simulated progress while they upload in a new tab
    let timer = null;
    function startSimProgress(){
      clearInterval(timer);
      let p = 8;
      setProgress(p);
      timer = setInterval(() => {
        if (p < 86) p += Math.round((86 - p) * 0.12) + 1;
        setProgress(p);
      }, 700);
    }
    function finishProgress(){
      clearInterval(timer);
      setProgress(100);
    }

    function photoStep(){
      stepTitle.textContent = "Step 1 of 2 â€” Photos";
      stepSub.textContent = "Optional, but helps a lot.";
      setProgress(0);

      addMsg(`
        <div class="card">
          <h4>Upload photos first</h4>
          <p>
            If you can, upload 1â€“5 photos (wide shot + close-up). It helps providers estimate faster and more accurately.
          </p>
          <div class="btnRow">
            <a class="btn primary" id="uploadBtn" href="${DROPBOX_LINK}" target="_blank" rel="noreferrer">Upload photos â†—</a>
            <button class="btn warn" id="skipBtn" type="button">Skip</button>
          </div>
        </div>
      `, "bot", true);

      addMsg(`
        <div class="card">
          <h4>When youâ€™re done</h4>
          <p>Come back here, check the box, and continue.</p>

          <div class="checkboxRow">
            <input id="done" type="checkbox" style="width:18px;height:18px; accent-color: var(--accent2);" />
            <label for="done" style="margin:0; font-size:13px; color:rgba(255,255,255,.88);">
              I uploaded my photos (or Iâ€™m skipping)
            </label>
          </div>

          <div class="btnRow" style="margin-top:12px;">
            <button class="btn primary" id="continueBtn" type="button" disabled>Continue â†’</button>
          </div>
        </div>
      `, "bot", true);

      const uploadBtn = document.getElementById("uploadBtn");
      const skipBtn = document.getElementById("skipBtn");
      const done = document.getElementById("done");
      const continueBtn = document.getElementById("continueBtn");

      uploadBtn.addEventListener("click", () => {
        addMsg("Opening photo uploadâ€¦", "user");
        startSimProgress();
      });

      skipBtn.addEventListener("click", () => {
        addMsg("Skipping photos.", "user");
        startSimProgress();
        done.checked = true;
        continueBtn.disabled = false;
      });

      done.addEventListener("change", () => {
        continueBtn.disabled = !done.checked;
      });

      continueBtn.addEventListener("click", async () => {
        finishProgress();
        addMsg("Continuingâ€¦", "user");
        await sleep(250);
        formStep();
      });
    }

    function formStep(){
      stepTitle.textContent = "Step 2 of 2 â€” Request";
      stepSub.textContent = "Quick form, then we start outreach.";
      setProgress(100);

      addMsg(`
        <div class="card">
          <h4>Request form</h4>
          <p>
            Fill this out and submit. Pricing is quote-basedâ€”providers decide exact cost after reviewing your details.
          </p>

          <form id="requestForm" action="${FORMSPREE_ACTION}" method="POST">
            <div class="grid">
              <div>
                <label>Your name</label>
                <input name="name" required placeholder="Full name" />
              </div>
              <div>
                <label>Email</label>
                <input type="email" name="email" required placeholder="you@email.com" />
              </div>
            </div>

            <div class="grid">
              <div>
                <label>Phone</label>
                <input name="phone" required placeholder="(###) ###-####" />
              </div>
              <div>
                <label>ZIP</label>
                <input name="zip" required placeholder="30024" />
              </div>
            </div>

            <div class="grid">
              <div>
                <label>Service</label>
                <select name="service" required>
                  <option value="" selected disabled>Select one</option>
                  <option>Plumbing</option>
                  <option>Electrical</option>
                  <option>HVAC</option>
                  <option>Handyman</option>
                  <option>Cleaning</option>
                  <option>Roofing</option>
                  <option>Landscaping</option>
                  <option>Pest Control</option>
                  <option>Painting</option>
                  <option>Moving</option>
                </select>
              </div>
              <div>
                <label>Urgency</label>
                <select name="urgency" required>
                  <option value="" selected disabled>Select one</option>
                  <option>Emergency</option>
                  <option>Soon</option>
                  <option>Flexible</option>
                </select>
              </div>
            </div>

            <label>Budget goal (approx.)</label>
            <select name="budget_goal" required>
              <option value="" selected disabled>Select one</option>
              <option>Under $250</option>
              <option>$250â€“$750</option>
              <option>$750â€“$1,500</option>
              <option>$1,500â€“$3,000</option>
              <option>$3,000â€“$7,500</option>
              <option>$7,500+</option>
              <option>Not sure</option>
            </select>

            <label>Describe what you need</label>
            <textarea name="message" required placeholder="Describe the issue, where it is, and anything importantâ€¦"></textarea>

            <div style="margin-top:10px; color: rgba(255,255,255,.70); font-size:12px; line-height:1.45;">
              <b>Note:</b> Photo upload happens in Dropbox. Please make sure you uploaded photos before submitting this form.
            </div>

            <div class="btnRow" style="justify-content:flex-end; margin-top:12px;">
              <button class="btn primary" id="submitBtn" type="submit">Submit â†’</button>
            </div>

            <div class="sendStatus" id="sendStatus">
              <span class="spin"></span>
              <span id="sendText">Sending your requestâ€¦</span>
            </div>
          </form>
        </div>
      `, "bot", true);

      wireSubmit();
    }

    function wireSubmit(){
      const form = document.getElementById("requestForm");
      const submitBtn = document.getElementById("submitBtn");
      const sendStatus = document.getElementById("sendStatus");
      const sendText = document.getElementById("sendText");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        submitBtn.disabled = true;
        submitBtn.textContent = "Sendingâ€¦";
        sendStatus.style.display = "flex";
        sendText.textContent = "Sending your requestâ€¦";

        const t = addTyping();

        try{
          const fd = new FormData(form);
          fd.append("source", "MatchFlow Chat");
          fd.append("timestamp", new Date().toISOString());
          fd.append("dropbox_upload_link", DROPBOX_LINK);

          const res = await fetch(form.action, {
            method: "POST",
            body: fd,
            headers: { "Accept": "application/json" }
          });

          t.remove();

          if(res.ok){
            await botSay("Got it âœ… We received your request.");
            await botSay("Sending you to a quick processing screenâ€¦");
            await sleep(650);
            window.location.href = "processing.html";
          } else {
            submitBtn.disabled = false;
            submitBtn.textContent = "Submit â†’";
            sendText.textContent = "Something went wrong. Please try again.";
          }
        } catch(err){
          t.remove();
          submitBtn.disabled = false;
          submitBtn.textContent = "Submit â†’";
          sendText.textContent = "Network error. Please try again.";
        }
      });
    }

    (async function init(){
      await botSay("Hey ðŸ‘‹ Iâ€™m MatchFlow. Iâ€™ll help you submit a service request quickly.");
      await botSay("First weâ€™ll upload photos (optional), then a short form.");
      await botSay("Letâ€™s do it.");
      photoStep();
    })();
  </script>
</body>
</html>
